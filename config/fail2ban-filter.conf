# Fail2Ban Filter for KI-Mail-Helper
# Detects failed login attempts, account lockouts, and 2FA failures
#
# Installation:
# sudo cp fail2ban-filter.conf /etc/fail2ban/filter.d/mail-helper.conf
# sudo systemctl restart fail2ban

[Definition]

# Failed Login Attempts (invalid credentials or user not found)
failregex = ^.*SECURITY\[LOGIN_FAILED\]: user=\S+ ip=<HOST>.*$
            ^.*SECURITY\[2FA_FAILED\]: user=\S+ ip=<HOST>.*$
            ^.*SECURITY\[LOCKOUT\]: user=\S+ ip=<HOST>.*$

# Ignore successful logins and logouts
ignoreregex = ^.*SECURITY\[LOGIN_SUCCESS\]:.*$
              ^.*SECURITY\[LOGOUT\]:.*$

# Date pattern (ISO 8601 format used by Python logging)
datepattern = ^%%Y-%%m-%%d %%H:%%M:%%S
