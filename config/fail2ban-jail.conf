# Fail2Ban Jail for KI-Mail-Helper
# Bans IPs after repeated failed login attempts
#
# Installation:
# sudo cp fail2ban-jail.conf /etc/fail2ban/jail.d/mail-helper.conf
# sudo systemctl restart fail2ban
#
# Check status:
# sudo fail2ban-client status mail-helper

[mail-helper]
enabled = true
port = http,https
filter = mail-helper
# WICHTIG: Pfad anpassen an deine Installation!
# Standard: /opt/KI-Mail-Helper oder /home/USER/projects/KI-Mail-Helper
logpath = /var/log/mail-helper/gunicorn_error.log
          /var/log/mail-helper/gunicorn_access.log
# Alternativ mit relativem Pfad (empfohlen):
# logpath = %(basedir)s/logs/gunicorn_error.log
#           %(basedir)s/logs/gunicorn_access.log
maxretry = 5
findtime = 600
bantime = 3600
action = iptables-multiport[name=MailHelper, port="http,https"]

# Configuration:
# - maxretry: Number of failed attempts before ban (5)
# - findtime: Time window for counting attempts (600s = 10min)
# - bantime: Duration of ban (3600s = 1 hour)
#
# Examples:
# - 5 failed logins in 10min → 1 hour ban
# - 5 invalid 2FA codes in 10min → 1 hour ban
# - Account lockout triggered → logged for monitoring
#
# Note: Combines with app-level rate limiting (Flask-Limiter)
#       and account lockout (5 attempts → 15min ban)
