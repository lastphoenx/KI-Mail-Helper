# Log Rotation Configuration für Mail Helper
# Installation: sudo cp logrotate.conf /etc/logrotate.d/mail-helper
#
# WICHTIG: Pfad anpassen an deine Installation!
# Standard: /opt/KI-Mail-Helper oder /home/USER/projects/KI-Mail-Helper

/opt/KI-Mail-Helper/logs/*.log {
    # Rotation Policy
    daily                   # Täglich rotieren
    rotate 30              # 30 Tage behalten
    missingok              # Kein Fehler wenn Log fehlt
    notifempty             # Nicht rotieren wenn leer
    compress               # Alte Logs komprimieren
    delaycompress          # Erst beim nächsten Durchlauf komprimieren
    
    # Permissions
    create 0640 thomas thomas  # WICHTIG: User/Group anpassen!
    
    # Post-Rotation Action
    postrotate
        # Gunicorn neu laden (graceful reload ohne Downtime)
        systemctl reload mail-helper.service > /dev/null 2>&1 || true
    endscript
    
    # Size Limit (optional)
    # size 100M             # Rotieren wenn >100MB
    
    # Alternatives: Weekly Rotation
    # weekly
    # rotate 12             # 12 Wochen = 3 Monate
}

# Separate Policy für Error-Logs (längere Retention)
/opt/KI-Mail-Helper/logs/gunicorn_error.log {
    daily
    rotate 90              # 90 Tage für Error-Logs
    missingok
    notifempty
    compress
    delaycompress
    create 0640 thomas thomas
    sharedscripts
    postrotate
        systemctl reload mail-helper.service > /dev/null 2>&1 || true
    endscript
}
